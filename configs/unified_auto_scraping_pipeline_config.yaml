# SO8T統制Webスクレイピング全自動パイプライン設定ファイル

# パイプライン全体設定
pipeline:
  name: "SO8T統制Webスクレイピング全自動パイプライン"
  output_base_dir: "D:/webdataset/processed"
  checkpoint_dir: "D:/webdataset/checkpoints/unified_pipeline"
  resume: false  # 電源投入時に既収集データを読み込まない
  checkpoint_interval: 180.0  # チェックポイント保存間隔（秒、3分）
  max_checkpoints: 5  # 最大チェックポイント数（ローリングストック）
  session_id_format: "%Y%m%d_%H%M%S"

# スクレイピングスクリプト設定
scraping_scripts:
  - name: "parallel_deep_research"
    enabled: true
    priority: 1
    description: "並列DeepResearch Webスクレイピング（10個のブラウザ、SO8T統制）"
    output_dir: "D:/webdataset/processed/parallel_deep_research"
    timeout: 86400  # 24時間
    
  - name: "arxiv_open_access"
    enabled: true
    priority: 2
    description: "Arxiv・オープンアクセス論文スクレイピング（SO8T統制）"
    output_dir: "D:/webdataset/processed/arxiv_open_access"
    timeout: 86400  # 24時間
    
  - name: "auto_background"
    enabled: true
    priority: 3
    description: "SO8T統制完全自動バックグラウンドスクレイピング"
    output_dir: "D:/webdataset/processed/auto_background"
    timeout: 86400  # 24時間

# データパイプライン処理設定
data_pipeline:
  enabled: true
  script: "scripts/pipelines/web_scraping_data_pipeline.py"
  input_dir: "D:/webdataset/processed"
  output_dir: "D:/webdataset/cleaned"
  use_so8t: true  # SO8T四値分類を使用
  num_workers: 4  # 並列処理ワーカー数
  batch_size: 100  # バッチサイズ
  timeout: 43200  # 12時間

# データセット作成設定
dataset_creation:
  enabled: true
  output_dir: "D:/webdataset/datasets"
  dataset_name: "so8t_dataset"
  train_test_split: false  # 訓練/テスト分割を作成するか
  train_ratio: 0.8  # 訓練データ比率（train_test_splitがtrueの場合）

# RAG/CoG用ベクトルストア作成設定
vector_store_creation:
  enabled: true
  output_dir: "D:/webdataset/vector_stores"
  rag:
    chunk_size: 512  # RAGチャンクサイズ（文字数）
    overlap: 128  # RAGオーバーラップサイズ（文字数）
    embedding_model: "sentence-transformers/paraphrase-multilingual-mpnet-base-v2"
  cog:
    # CoGはナレッジグラフ作成（NetworkX、RDF、JSON形式で保存）
    graph_formats: ["json", "graphml", "rdf"]  # 保存形式
    entity_extraction: "pattern_based"  # エンティティ抽出方法（pattern_based, ner_model）
    relation_extraction: "co_occurrence"  # リレーション抽出方法（co_occurrence, dependency_parsing）

# エラーハンドリング設定
error_handling:
  # 404エラー・200エラー（コンテンツなし）の自動処理
  auto_handle_404: true
  auto_handle_200_empty: true
  browser_back_on_error: true  # エラー時にブラウザバック
  switch_keyword_on_error: true  # エラー時に別キーワードへ遷移
  max_retries_per_keyword: 3  # キーワードごとの最大リトライ回数
  
  # エラーリカバリー設定
  auto_recovery: true
  recovery_delay: 60.0  # リカバリー待機時間（秒）
  max_recovery_attempts: 5  # 最大リカバリー試行回数

# バックグラウンド実行設定
background_execution:
  daemon_mode: true  # デーモンモード（バックグラウンド実行）
  auto_restart: true  # 自動再起動
  max_restarts: 10  # 最大再起動回数
  restart_delay: 3600.0  # 再起動待機時間（秒）
  session_interval: 86400.0  # セッション間隔（秒、24時間）

# ロギング設定
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  log_dir: "logs"
  log_file: "logs/unified_auto_scraping_pipeline.log"
  max_log_size: 10485760  # 10MB
  backup_count: 5

# リソース管理設定
resource_management:
  max_cpu_percent: 80.0  # 最大CPU使用率（%）
  max_memory_percent: 80.0  # 最大メモリ使用率（%）
  check_interval: 60.0  # リソースチェック間隔（秒）
  throttle_on_high_usage: true  # 高負荷時にスロットル

# 通知設定
notifications:
  enable_audio_notification: true  # 音声通知を有効化
  audio_file: "C:/Users/downl/Desktop/SO8T/.cursor/marisa_owattaze.wav"
  notify_on_completion: true  # 完了時に通知
  notify_on_error: true  # エラー時に通知

