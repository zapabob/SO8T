# NSFW・違法薬物検知目的QLoRA学習用データ生成全自動パイプライン設定ファイル

# 基本設定
session_id_format: "%Y%m%d_%H%M%S"
checkpoint_dir: "D:/webdataset/checkpoints/nsfw_drug_detection_qlora_training_data_pipeline"
output_dir: "D:/webdataset/nsfw_drug_detection_qlora_training_data"

# Phase 1: NSFW検知データセット収集
nsfw_detection_dataset:
  enabled: true
  required: true
  output_dir: "D:/webdataset/nsfw_detection_dataset"
  max_samples: 50000
  nsfw_classifier_path: null  # nullの場合はデフォルト
  use_multimodal: true
  include_synthetic: true
  synthetic_samples: 1000
  include_metadata: true
  timeout: 14400  # 4時間タイムアウト

# Phase 2: 違法薬物検知データセット収集
drug_detection_dataset:
  enabled: true
  required: true
  output_dir: "D:/webdataset/drug_pharmaceutical_detection_dataset"
  max_samples_per_source: 1000
  sources: ["all"]  # ["pmda", "gov", "who", "unodc", "emcdda", "wikipedia", "all"]
  timeout: 14400  # 4時間タイムアウト

# Phase 3: ドメイン別知識データセット収集
domain_knowledge_dataset:
  enabled: true
  required: true
  output_dir: "D:/webdataset/domain_knowledge_collected"
  domains: ["defense", "aerospace", "transport", "general"]  # ["defense", "aerospace", "transport", "general", "nsfw_detection", "drug_detection"]
  so8t_model_path: null  # nullの場合は自動検出
  use_cursor_browser: false  # falseの場合は新しいブラウザを起動（headless=False）
  remote_debugging_port: 9222
  delay_per_request: 2.0
  timeout: 30000
  max_pages_per_domain: 100
  max_depth: 3
  quality_threshold: 0.7
  timeout: 14400  # 4時間タイムアウト
  # ボタンクリック機能設定
  enable_button_click: true  # ボタンクリックでページ遷移を有効化
  max_button_clicks_per_page: 3  # ページあたりの最大ボタンクリック数
  button_click_delay: [1.5, 3.0]  # ボタンクリック後の待機時間（秒）[最小, 最大]

# Phase 5: 4値分類・四重推論設定
quadruple_classification:
  enabled: true
  required: true
  so8t_model_path: null  # nullの場合は自動検出
  use_rule_based_fallback: true  # SO8Tモデルが利用できない場合のルールベース分類フォールバック
  timeout: 7200  # 2時間タイムアウト

# Phase 7: 統計的データクレンジング設定
statistical_cleaning:
  enabled: true
  required: true
  # 重複検出設定
  duplicate_detection:
    hash_based: true
    similarity_based: true
    similarity_threshold: 0.95  # 95%以上類似している場合は重複とみなす
  # 外れ値検出設定
  outlier_detection:
    zscore_enabled: true
    zscore_threshold: 3.0  # |z| > 3 の場合は外れ値
    iqr_enabled: true
    iqr_multiplier: 1.5  # IQR * 1.5 の範囲外は外れ値
  # 統計的品質スコアリング設定
  quality_scoring:
    enabled: true
    min_quality_score: 0.5
  # 信頼区間フィルタリング設定
  confidence_interval:
    enabled: true
    confidence_level: 0.95  # 95%信頼区間

# Phase 8: QLoRA学習用データセット形式設定
qlora_training_data:
  enabled: true
  required: true
  # instruction-output形式設定
  instruction_format: "instruction_output"  # "instruction_output" または "chat"
  max_text_length: 2000  # 最大テキスト長
  min_text_length: 50  # 最小テキスト長
  include_quadruple_reasoning: true  # 四重推論結果を含める
  include_metadata: true  # メタデータを含める


