# 並列学習クロール実装ログ

## 実装日時
2025-11-07

## 実装内容
学習処理（`scripts/train_so8t_qwen.py`）とクロール処理（`so8t-mmllm/scripts/data/collect_japanese_data.py`）を並列実行する統合スクリプトを実装しました。

## 実装ファイル
- `scripts/run_parallel_train_crawl.py` (新規作成)

## 実装機能

### 1. 並列実行機能
- `threading.Thread`を使用して学習とクロールを別スレッドで実行
- `subprocess.Popen`で各スクリプトを独立したプロセスとして起動
- 両プロセスを同時に実行し、効率的にリソースを活用

### 2. プロセス管理
- `ProcessStatus`データクラスで各プロセスの状態を管理
- PID、開始時刻、終了時刻、ステータス、エラー情報を追跡
- シグナルハンドラーで電源断時のクリーンアップを実装

### 3. 進捗表示
- `tqdm`を使用したリアルタイム進捗表示
- 各プロセスの完了状況を視覚的に表示
- プロセス状態を定期的に監視・更新

### 4. エラーハンドリング
- 各プロセスの例外を個別にキャッチ
- エラー発生時も他プロセスは継続実行
- エラーメッセージをログファイルに記録
- プロセスの戻り値をチェックして成功/失敗を判定

### 5. ログ出力
- 学習ログ: `logs/train_YYYYMMDD_HHMMSS.log`
- クロールログ: `logs/crawl_YYYYMMDD_HHMMSS.log`
- 統合ログ: `logs/parallel_train_crawl.log`
- 各プロセスの出力を個別のログファイルに保存

### 6. 完了通知
- 完了時に音声ファイル（`marisa_owattaze.wav`）を再生
- PowerShellコマンドで音声通知を実行
- 完了レポートを`_docs/`ディレクトリに保存

### 7. レポート生成
- 実行結果をMarkdown形式でレポート生成
- 実行時間、ステータス、エラー情報を記録
- ファイル名: `_docs/YYYY-MM-DD_parallel_train_crawl.md`

## 使用方法

### 基本実行
```bash
python scripts/run_parallel_train_crawl.py --train-config configs/training_config.yaml --crawl-target 10000
```

### オプション
- `--train-config`: 学習設定ファイルのパス（デフォルト: `configs/training_config.yaml`）
- `--crawl-target`: クロール目標サンプル数（デフォルト: 10000）
- `--crawl-workers`: クロールワーカー数（デフォルト: 4）
- `--no-web-crawl`: Webクロールを無効化
- `--no-auto-resume`: 自動再開を無効化

## 技術仕様

### 使用ライブラリ
- `threading`: 並列実行
- `subprocess`: 外部スクリプト実行
- `tqdm`: 進捗表示
- `logging`: ログ出力
- `dataclasses`: データ構造管理

### プロセス間通信
- 各プロセスは独立したsubprocessとして実行
- スレッド間で状態を共有（ProcessStatusオブジェクト）
- ログファイルで各プロセスの出力を分離

### 電源断対応
- SIGINT、SIGTERM、SIGBREAKシグナルをハンドリング
- シグナル受信時にプロセスをクリーンアップ
- タイムアウト付きプロセス終了処理

## 実装結果

### 完了した機能
- [OK] 並列実行スクリプト作成
- [OK] プロセス管理機能実装
- [OK] 進捗追跡と表示機能実装
- [OK] エラーハンドリング実装
- [OK] 完了通知とレポート生成実装

### テスト項目
- 並列実行の動作確認
- エラーハンドリングの動作確認
- 音声通知の動作確認
- レポート生成の動作確認

## 今後の改善点
- ログファイルのリアルタイム監視機能
- より詳細な進捗情報の表示
- プロセス間のリソース使用状況の監視
- チェックポイントからの自動再開機能の強化

## 備考
- 学習とクロールは完全に独立して実行される
- 各プロセスのエラーは他プロセスに影響しない
- ログファイルはタイムスタンプ付きで保存される
- 音声通知は完了時に自動的に再生される































