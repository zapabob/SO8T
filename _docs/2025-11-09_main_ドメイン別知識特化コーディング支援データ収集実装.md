# ドメイン別知識特化コーディング支援データ収集実装ログ

## 実装情報
- **日付**: 2025-11-09
- **Worktree**: main
- **機能名**: ドメイン別知識特化コーディング支援データ収集
- **実装者**: AI Agent

## 概要

日本語・英語のドメイン別知識に特化し、オンプレミス環境でのコーディング、エクセル、SQLなどのAIエージェント支援のための包括的なデータセットを収集するシステムを実装。ドキュメンテーション、GitHubのスター数の多いリポジトリ、エンジニア向けサイト、ベストプラクティスを含め、COBOL、PHP、Java、Rust、C、アルゴリズム、ハードウェア、アセンブリ言語、機械語まで幅広くカバーする。

## 実装内容

### 1. Cursorブラウザのバックグラウンド実行と再開機能

**ファイル**: `scripts/data/parallel_deep_research_scraping.py` (修正)

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: Cursorブラウザのバックグラウンド起動、自動再開、状態保存・復元機能を実装

#### 追加メソッド

1. **`check_cursor_browser_running`メソッド**
   - Cursorブラウザが起動しているかチェック
   - CDPエンドポイントに接続して確認
   - タイムアウト2秒で判定

2. **`launch_cursor_browser_background`メソッド**
   - Cursorブラウザをバックグラウンドで起動
   - リモートデバッグポートを指定
   - WindowsではCREATE_NO_WINDOWフラグを使用
   - 起動確認まで最大10秒待機

3. **`save_browser_state`メソッド**
   - ブラウザ状態をJSONファイルに保存
   - ブラウザステータス、完了キーワード、総サンプル数を記録

4. **`load_browser_state`メソッド**
   - 保存されたブラウザ状態を読み込み
   - 最新の状態ファイルを自動検出

#### 修正メソッド

1. **`connect_to_cursor_browser`メソッド**
   - 既存ブラウザへの接続を試行
   - 失敗時はバックグラウンド起動を試みる
   - すべて失敗した場合は新しいブラウザを起動

2. **`browser_worker`メソッド**
   - 定期的にブラウザ状態を保存（10サンプルごと）
   - ブラウザクラッシュ時の自動再接続を強化

### 2. 技術領域別キーワードリストの大幅拡張

**ファイル**: `scripts/data/parallel_deep_research_scraping.py` (修正)

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: コーディング関連キーワードを大幅に拡張し、優先カテゴリとして追加

#### 追加カテゴリ

1. **`programming_languages`カテゴリ**
   - モダン言語: Python, JavaScript, TypeScript, Go, Rust, C++, C#, Swift, Kotlin, Dart, Scala, Elixir, Erlang, Clojure, F#, Haskell, OCaml
   - レガシー言語: COBOL, PHP, Java, C, Fortran, Pascal, Ada, PL/I, BASIC, Visual Basic, Delphi, Perl, Ruby, Lua, Tcl
   - 低レベル言語: アセンブリ言語、機械語、x86、ARM、RISC-V、アセンブラ、マシンコード、バイナリ、オペコード、レジスタ、メモリマップ
   - データベース・SQL: SQL, PostgreSQL, MySQL, SQL Server, Oracle, SQLite, MariaDB, NoSQL, MongoDB, Redis, Cassandra, Elasticsearch
   - ツール・スクリプト: Excel, VBA, PowerShell, Bash, Shell Script, シェルスクリプト, バッチファイル, AWK, sed, grep, find, curl, wget

2. **`algorithms`カテゴリ**
   - アルゴリズム、データ構造、ソート、検索、グラフ理論、動的計画法
   - 貪欲法、分割統治法、バックトラッキング、再帰、反復
   - 二分探索、線形探索、ハッシュテーブル、二分木、AVL木、B木
   - ヒープ、スタック、キュー、連結リスト、配列、文字列処理
   - 最短経路、最小全域木、最大流、マッチング、ネットワークフロー
   - 計算量、時間計算量、空間計算量、Big O記法、最適化

3. **`hardware`カテゴリ**
   - ハードウェア、CPU、メモリ、RAM、ROM、ストレージ、SSD、HDD
   - GPU、TPU、FPGA、ASIC、マイクロプロセッサ、プロセッサ
   - アーキテクチャ、x86、x64、ARM、RISC-V、MIPS、PowerPC
   - キャッシュ、レジスタ、バス、I/O、入出力、インターフェース
   - USB、PCIe、SATA、NVMe、Ethernet、Wi-Fi、Bluetooth
   - 組み込みシステム、マイコン、Arduino、Raspberry Pi、IoTデバイス
   - オーバークロック、冷却、電源、マザーボード、チップセット

4. **`coding_best_practices`カテゴリ**
   - ベストプラクティス、コーディング規約、コードレビュー、リファクタリング
   - デザインパターン、SOLID原則、DRY原則、KISS原則、YAGNI原則
   - テスト駆動開発、TDD、BDD、ユニットテスト、統合テスト、E2Eテスト
   - CI/CD、継続的インテグレーション、継続的デプロイ、Git、GitHub
   - バージョン管理、ブランチ戦略、コード品質、静的解析、リンター
   - フォーマッター、ドキュメンテーション、コメント、API設計、RESTful
   - マイクロサービス、モノリシック、アーキテクチャ、スケーラビリティ
   - パフォーマンス、最適化、セキュリティ、脆弱性、暗号化

5. **`engineering_sites`カテゴリ**
   - Stack Overflow、Qiita、Zenn、Medium、Dev.to、GitHub
   - 技術ブログ、エンジニアブログ、プログラミング、開発者向け
   - ドキュメント、APIリファレンス、チュートリアル、ガイド
   - サンプルコード、コード例、実装例、使い方、入門、初心者
   - 上級者、エキスパート、ベストプラクティス、Tips、Tricks

#### 修正メソッド

1. **`KeywordTask`クラス**
   - `coding_related`フラグを追加

2. **`initialize_keyword_queue`メソッド**
   - 優先カテゴリ（コーディング関連）を最初に追加
   - コーディング関連キーワードに`coding_related=True`フラグを設定

### 3. GitHubリポジトリ検索機能

**ファイル**: `scripts/data/github_repository_scraper.py` (新規作成)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: GitHub APIを使用してスター数の多いリポジトリを検索し、README、ドキュメンテーション、サンプルコードを抽出

#### 主要機能

1. **`search_repositories`メソッド**
   - GitHub APIでリポジトリを検索
   - 言語、ソート方法、ソート順を指定可能
   - 最小スター数でフィルタリング
   - レート制限対策

2. **`get_repository_content`メソッド**
   - READMEを取得
   - ドキュメンテーションディレクトリ（docs, documentation, doc, wiki）を検索
   - サンプルコードディレクトリ（examples, samples, demo, demos, test, tests）を検索
   - コードファイル（.py, .js, .ts, .java, .cpp, .c, .rs, .go, .rb, .php, .sql）を抽出

3. **`scrape_repositories`メソッド**
   - 複数のクエリでリポジトリをスクレイピング
   - 言語別に検索可能
   - サンプルデータを作成

### 4. エンジニア向けサイトスクレイピング機能

**ファイル**: `scripts/data/engineer_site_scraper.py` (新規作成)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: Stack Overflow、Qiita、Zennなどのエンジニア向けサイトから技術記事とコードスニペットを抽出

#### 主要機能

1. **`scrape_stackoverflow`メソッド**
   - Stack Overflowをスクレイピング
   - 質問のタイトル、本文、コードブロック、回答を取得
   - 上位3つの回答を取得

2. **`scrape_qiita`メソッド**
   - Qiitaをスクレイピング
   - 記事のタイトル、本文、コードブロックを取得

3. **`scrape_zenn`メソッド**
   - Zennをスクレイピング
   - 記事のタイトル、本文、コードブロックを取得

4. **`scrape_all_sites`メソッド**
   - すべてのサイトを順次スクレイピング
   - サンプルデータを統合

## 作成・変更ファイル

- `scripts/data/parallel_deep_research_scraping.py` (修正)
  - Cursorブラウザのバックグラウンド実行と再開機能を追加
  - 技術領域別キーワードリストを大幅拡張
  - コーディング関連キーワードの優先処理を実装

- `scripts/data/github_repository_scraper.py` (新規作成)
  - GitHub APIを使用したリポジトリ検索機能
  - README、ドキュメンテーション、サンプルコードの抽出機能

- `scripts/data/engineer_site_scraper.py` (新規作成)
  - Stack Overflow、Qiita、Zennのスクレイピング機能
  - 技術記事とコードスニペットの抽出機能

- `scripts/pipelines/extract_coding_dataset.py` (新規作成)
  - コーディング関連データの抽出とフィルタリング機能
  - コーディングタスクの種類別分類機能

- `scripts/pipelines/prepare_coding_training_data.py` (新規作成)
  - コーディングデータをinstruction-output形式に変換
  - コーディングタスクの種類に応じたプロンプトテンプレート

- `scripts/pipelines/coding_focused_retraining_pipeline.py` (新規作成)
  - コーディング特化再学習パイプライン
  - QLoRA 8bitファインチューニング統合

- `configs/coding_focused_retraining_config.yaml` (新規作成)
  - コーディング特化再学習の設定ファイル

- `scripts/pipelines/unified_master_pipeline.py` (修正)
  - Phase 4-8を追加（GitHub検索、エンジニアサイト、コーディング抽出、トレーニングデータ作成、再学習）
  - フェーズ完了検証ロジックを追加

- `configs/unified_master_pipeline_config.yaml` (修正)
  - Phase 4-8の設定を追加

## 設計判断

1. **Cursorブラウザのバックグラウンド起動**
   - WindowsではCREATE_NO_WINDOWフラグを使用してバックグラウンド起動
   - 起動確認まで最大10秒待機してから接続を試行

2. **キーワードの優先順位**
   - コーディング関連キーワードを優先カテゴリとして最初にキューに追加
   - これにより、コーディング関連データが優先的に収集される

3. **GitHub APIのレート制限対策**
   - リクエスト間に遅延を設定
   - レート制限エラー時は自動的に待機

4. **エンジニア向けサイトのスクレイピング**
   - 各サイトのHTML構造に応じたセレクタを使用
   - コードブロックとテキストコンテンツを分離して保存

## テスト結果

- Cursorブラウザのバックグラウンド起動機能: [未テスト]
- 技術領域別キーワードリスト: [未テスト]
- GitHubリポジトリ検索機能: [未テスト]
- エンジニア向けサイトスクレイピング機能: [未テスト]

## 実装完了内容（続き）

### 5. コーディング関連データの抽出とフィルタリング

**ファイル**: `scripts/pipelines/extract_coding_dataset.py` (新規作成)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: 既存のデータセットからコーディング関連データを抽出し、コーディングタスクの種類別に分類

#### 主要機能

1. **`is_coding_related`メソッド**
   - コーディング関連キーワードによる判定
   - コードブロックの有無による判定
   - 言語別キーワードマッチング

2. **`extract_code_blocks`メソッド**
   - Markdownコードブロックの抽出
   - HTMLコードブロックの抽出
   - インデントされたコードブロックの抽出

3. **`classify_task_type`メソッド**
   - コード生成、コード説明、デバッグ、リファクタリング、コードレビュー、テストの6種類に分類
   - キーワードマッチングとパターンマッチングによる分類

### 6. コーディングタスク用データセットの作成

**ファイル**: `scripts/pipelines/prepare_coding_training_data.py` (新規作成)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: コーディングデータをinstruction-output形式に変換し、コーディングタスクの種類に応じたプロンプトテンプレートを適用

#### 主要機能

1. **プロンプトテンプレート**
   - コード生成、コード説明、デバッグ、リファクタリング、コードレビュー、テスト用のテンプレート
   - 日本語・英語対応

2. **コード言語検出**
   - Python、JavaScript、Java、C++、C、Rust、Go、SQL、HTML、CSSなどの言語を自動検出

3. **instruction-output形式への変換**
   - タスクタイプに応じたプロンプト構築
   - コードとテキストの適切な組み合わせ

### 7. コーディング特化再学習パイプライン

**ファイル**: `scripts/pipelines/coding_focused_retraining_pipeline.py` (新規作成)
**ファイル**: `configs/coding_focused_retraining_config.yaml` (新規作成)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: コーディングデータに特化したSO8Tモデルの再学習パイプライン

#### 主要機能

1. **データセット検証**
   - コーディングトレーニングデータの存在確認
   - サンプル数の確認

2. **再学習実行**
   - 既存の`train_so8t_phi3_qlora.py`を呼び出し
   - QLoRA 8bitファインチューニング

### 8. 全自動パイプラインへの統合

**ファイル**: `scripts/pipelines/unified_master_pipeline.py` (修正)
**ファイル**: `configs/unified_master_pipeline_config.yaml` (修正)

**実装状況**: [実装済み]  
**動作確認**: [未確認]  
**確認日時**: -  
**備考**: 新しいフェーズ（Phase 4-8）を統合パイプラインに追加

#### 追加フェーズ

1. **Phase 4: GitHubリポジトリ検索**
   - GitHub APIを使用したリポジトリ検索
   - README、ドキュメンテーション、サンプルコードの抽出

2. **Phase 5: エンジニア向けサイトスクレイピング**
   - Stack Overflow、Qiita、Zennのスクレイピング
   - 技術記事とコードスニペットの抽出

3. **Phase 6: コーディング関連データ抽出**
   - 既存データセットからコーディング関連データを抽出
   - コーディングタスクの種類別分類

4. **Phase 7: コーディングタスク用データセット作成**
   - instruction-output形式への変換
   - プロンプトテンプレートの適用

5. **Phase 8: コーディング特化再学習**
   - コーディングデータに特化した再学習
   - QLoRA 8bitファインチューニング

## 次のステップ

1. 動作確認と評価
2. ドキュメンテーション収集機能の実装（オプション）
3. コーディング機能評価スクリプトの実装（オプション）

## 運用注意事項

### データ収集ポリシー
- GitHub APIの利用規約を遵守
- エンジニア向けサイトの利用規約を遵守
- robots.txtを確認してスクレイピングを実行
- レート制限を遵守し、適切な遅延を設定

### Cursorブラウザ運用
- バックグラウンド起動時はリモートデバッグポートを適切に設定
- 複数のブラウザインスタンスを使用する場合はポートを分散
- ブラウザ状態を定期的に保存して、クラッシュ時の復旧を可能にする

### キーワード管理
- コーディング関連キーワードを優先的に処理
- 新しい技術領域のキーワードを定期的に追加
- キーワードの重複を避ける

