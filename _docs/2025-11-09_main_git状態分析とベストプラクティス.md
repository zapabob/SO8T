# Git状態分析とベストプラクティス

## 実装情報
- **日付**: 2025-11-09
- **Worktree**: main
- **機能名**: Git状態分析とベストプラクティス
- **実装者**: AI Agent

## 現在のGit状態

### ステージング済みファイル
- `.specstory/history/2025-11-09_03-27Z-webスクレイピングとデータ管理の自動化.md` (M - Modified)

### ステージングされていない変更
- `models/Borea-Phi-3.5-mini-Instruct-Jp` (サブモジュールのuntracked content)

### ブランチ状態
- **現在のブランチ**: `main`
- **リモートとの関係**: `origin/main`と同期済み
- **最新コミット**: `2aa95d9` - "Update history file for 2025-11-09 with staging and commit status"

## Gitベストプラクティス分析

### 1. コミットメッセージのベストプラクティス

**推奨される形式**:
```
feat: 機能の説明

- 変更内容の詳細1
- 変更内容の詳細2
- 変更内容の詳細3
```

**コミットタイプ**:
- `feat:` - 新機能追加
- `fix:` - バグ修正
- `docs:` - ドキュメント変更
- `style:` - コードスタイル変更（動作に影響なし）
- `refactor:` - リファクタリング
- `test:` - テスト追加・修正
- `chore:` - ビルドプロセスやツールの変更

**現在のプロジェクトでの実装**:
- ✅ コミットメッセージに詳細な説明を含める
- ✅ 変更内容を箇条書きで記載
- ✅ 日本語と英語の併用（プロジェクトの特性に合わせる）

### 2. ステージングのベストプラクティス

**推奨される方法**:

#### 方法1: 選択的ステージング（推奨）
```bash
# 関連するファイルのみをステージング
git add configs/unified_master_pipeline_config.yaml
git add scripts/pipelines/unified_master_pipeline.py
git add _docs/2025-11-09_main_*.md
git commit -m "feat: SO8T統制ChromeDev並列ブラウザCUDA分散処理パイプライン統合"
```

#### 方法2: 音声通知付きコミットスクリプト（推奨）
```powershell
# scripts/utils/commit_with_audio.ps1を使用
.\scripts\utils\commit_with_audio.ps1 -Message "feat: 機能説明" -Files @("file1.py", "file2.yaml")
```

#### 方法3: インタラクティブステージング
```bash
# 変更を確認しながらステージング
git add -p
```

**現在のプロジェクトでの実装**:
- ✅ `scripts/utils/commit_with_audio.ps1`が利用可能
- ✅ 音声通知機能付き
- ⚠️ サブモジュールの変更は通常ステージングしない

### 3. サブモジュールの扱い

**ベストプラクティス**:
- サブモジュール内の変更は通常、メインレポジトリにはコミットしない
- サブモジュールの変更が必要な場合は、サブモジュール内でコミットしてから、メインレポジトリでサブモジュールの参照を更新

**現在の状態**:
- `models/Borea-Phi-3.5-mini-Instruct-Jp`はサブモジュール
- `untracked content`はサブモジュール内の未追跡ファイル
- これは通常、メインレポジトリにはコミットしない

### 4. .gitignoreの管理

**ベストプラクティス**:
- 大きなファイル（モデル、データセット）は`.gitignore`で除外
- GGUFファイルは既に`.gitignore`で除外済み
- サブモジュールのパスも`.gitignore`に追加済み

**現在の状態**:
- ✅ `*.gguf`が`.gitignore`に含まれている
- ✅ `models/Borea-Phi-3.5-mini-Instruct-Jp`が`.gitignore`に含まれている
- ✅ `webdataset/**/*.gguf`が`.gitignore`に含まれている

### 5. コミット前のチェックリスト

**推奨されるチェックリスト**:
1. ✅ 変更内容を確認 (`git diff`)
2. ✅ ステージングするファイルを選択 (`git status`)
3. ✅ リンターエラーがないか確認 (`read_lints`)
4. ✅ テストが通るか確認（該当する場合）
5. ✅ コミットメッセージを準備
6. ✅ 音声通知スクリプトを使用（オプション）

### 6. ブランチ戦略

**ベストプラクティス**:
- `main`ブランチは常に動作する状態を保つ
- 機能追加は`feature/`ブランチで行う
- バグ修正は`fix/`ブランチで行う
- リリース前は`release/`ブランチで準備

**現在のプロジェクトでの実装**:
- ✅ `main`ブランチで直接作業（小規模プロジェクトの場合）
- ✅ ワークツリーを使用した並行開発（過去の実装）

## 推奨される次のステップ

### 現在のコミットを完了する場合

1. **コミットメッセージを確認・編集**
   - `.git/COMMIT_EDITMSG`を編集
   - または `git commit` でエディタを開く

2. **コミットを実行**
   ```bash
   git commit
   ```

3. **音声通知付きコミット（推奨）**
   ```powershell
   .\scripts\utils\commit_with_audio.ps1 -Message "docs: 履歴ファイル更新" -Files @(".specstory/history/2025-11-09_03-27Z-webスクレイピングとデータ管理の自動化.md")
   ```

### サブモジュールの変更を処理する場合

1. **サブモジュール内の変更を確認**
   ```bash
   cd models/Borea-Phi-3.5-mini-Instruct-Jp
   git status
   ```

2. **必要に応じてサブモジュール内でコミット**
   ```bash
   git add .
   git commit -m "chore: サブモジュールの更新"
   ```

3. **メインレポジトリでサブモジュールの参照を更新**
   ```bash
   cd ../..
   git add models/Borea-Phi-3.5-mini-Instruct-Jp
   git commit -m "chore: サブモジュール参照を更新"
   ```

## 実装状況

### 1. Gitワークフロー

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: `scripts/utils/commit_with_audio.ps1`が利用可能

### 2. コミットメッセージ規約

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: Conventional Commits形式を採用

### 3. .gitignore管理

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: GGUFファイルとサブモジュールが適切に除外されている

### 4. サブモジュール管理

**実装状況**: [実装済み]  
**動作確認**: [OK]  
**確認日時**: 2025-11-09  
**備考**: サブモジュールの変更は通常コミットしない

## ベストプラクティス推奨事項

### 1. コミット前の確認
- ✅ 変更内容を`git diff`で確認
- ✅ ステージングするファイルを`git status`で確認
- ✅ リンターエラーを`read_lints`で確認

### 2. コミットメッセージ
- ✅ Conventional Commits形式を使用
- ✅ 日本語と英語の併用（プロジェクトの特性に合わせる）
- ✅ 変更内容を箇条書きで記載

### 3. 音声通知
- ✅ `scripts/utils/commit_with_audio.ps1`を使用
- ✅ コミット前に音声通知を再生

### 4. サブモジュール
- ✅ サブモジュール内の変更は通常コミットしない
- ✅ 必要に応じてサブモジュール内でコミットしてから、メインレポジトリで参照を更新

## 運用注意事項

### データ収集ポリシー
- 利用条件を守りつつ、高信頼ソースとして優先使用
- robots.txt遵守を徹底
- 個人情報・機密情報の除外を徹底

### NSFWコーパス運用
- **主目的**: 安全判定と拒否挙動の学習（生成目的ではない）
- モデル設計とドキュメントに明記
- 分類器は検出・拒否用途のみ

### /thinkエンドポイント運用
- 四重Thinking部（`<think-*>`）は外部非公開を徹底
- `<final>`のみ返す実装を維持
- 監査ログでThinkingハッシュを記録（内容は非公開）

### Git運用
- コミット前に変更内容を確認
- 関連するファイルのみをステージング
- コミットメッセージは詳細に記載
- サブモジュールの変更は通常コミットしない
- 音声通知スクリプトを使用（オプション）

