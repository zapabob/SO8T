# 電源断リカバリー自動再開機能 - 使用方法

## 実行方法

### PowerShellでの実行

PowerShellでバッチファイルを実行する場合は、以下のいずれかの方法を使用してください：

#### 方法1: cmd /c を使用
```powershell
cmd /c scripts\setup_auto_resume.bat
```

#### 方法2: .\ を付ける
```powershell
.\scripts\setup_auto_resume.bat
```

#### 方法3: PowerShellスクリプトを使用（推奨）

**プロジェクトディレクトリから実行**:
```powershell
cd C:\Users\downl\Desktop\SO8T
powershell -ExecutionPolicy Bypass -File scripts\setup_auto_resume.ps1
```

**任意の場所から実行（クイック起動スクリプト）**:
```powershell
powershell -ExecutionPolicy Bypass -File C:\Users\downl\Desktop\SO8T\scripts\setup_auto_resume_quick.ps1
```

**絶対パスで実行**:
```powershell
powershell -ExecutionPolicy Bypass -File C:\Users\downl\Desktop\SO8T\scripts\setup_auto_resume.ps1
```

### コマンドプロンプトでの実行

コマンドプロンプトでは、そのまま実行できます：

```cmd
scripts\setup_auto_resume.bat
```

または

```cmd
cd scripts
setup_auto_resume.bat
```

## タスクスケジューラー登録

### 初回セットアップ

1. **管理者権限で実行**
   - PowerShellを管理者として開く
   - または、コマンドプロンプトを管理者として開く

2. **スクリプトを実行**

   **プロジェクトディレクトリから実行**:
   ```powershell
   cd C:\Users\downl\Desktop\SO8T
   powershell -ExecutionPolicy Bypass -File scripts\setup_auto_resume.ps1
   ```
   
   **任意の場所から実行（クイック起動）**:
   ```powershell
   powershell -ExecutionPolicy Bypass -File C:\Users\downl\Desktop\SO8T\scripts\setup_auto_resume_quick.ps1
   ```
   
   **コマンドプロンプトの場合**:
   ```cmd
   cd C:\Users\downl\Desktop\SO8T
   scripts\setup_auto_resume.bat
   ```

3. **確認**
   - タスクが正常に作成されたことを確認
   - タスクの詳細が表示されます

### タスクの確認

```powershell
schtasks /query /tn "SO8T-AutoResume"
```

### タスクの削除

```powershell
schtasks /delete /tn "SO8T-AutoResume" /f
```

## 自動再開の動作

### ログイン時の自動実行

1. Windowsにログインすると、自動的に `auto_resume_startup.bat` が実行されます
2. スクリプトは以下の処理を実行します：
   - セッションファイルの検索
   - 未完了の学習セッションの検出
   - 未完了のクロールセッションの検出
   - 自動再開の実行

### ログファイル

自動再開のログは以下の場所に保存されます：

- `logs/auto_resume.log`: 自動再開スクリプトのログ
- `logs/auto_resume_startup.log`: スタートアップスクリプトのログ

## トラブルシューティング

### エラー: モジュール 'scripts' を読み込むことができませんでした

**原因**: PowerShellでバッチファイルを直接実行しようとした場合に発生します。

**解決方法**:
- `cmd /c scripts\setup_auto_resume.bat` を使用
- または `.\scripts\setup_auto_resume.bat` を使用
- または PowerShellスクリプト版 (`setup_auto_resume.ps1`) を使用

### エラー: -File パラメーターの引数が存在しません

**原因**: プロジェクトディレクトリ以外から相対パスで実行した場合に発生します。

**解決方法**:
1. プロジェクトディレクトリに移動してから実行:
   ```powershell
   cd C:\Users\downl\Desktop\SO8T
   powershell -ExecutionPolicy Bypass -File scripts\setup_auto_resume.ps1
   ```

2. 絶対パスで実行:
   ```powershell
   powershell -ExecutionPolicy Bypass -File C:\Users\downl\Desktop\SO8T\scripts\setup_auto_resume.ps1
   ```

3. クイック起動スクリプトを使用（任意の場所から実行可能）:
   ```powershell
   powershell -ExecutionPolicy Bypass -File C:\Users\downl\Desktop\SO8T\scripts\setup_auto_resume_quick.ps1
   ```

### エラー: 管理者権限が必要です

**原因**: タスクスケジューラーの登録には管理者権限が必要です。

**解決方法**:
- PowerShellまたはコマンドプロンプトを管理者として開く
- 右クリック → 「管理者として実行」を選択

### タスクが実行されない

**確認事項**:
1. タスクが正常に登録されているか確認
   ```powershell
   schtasks /query /tn "SO8T-AutoResume"
   ```
2. タスクの実行条件を確認
   - ログイン時に実行される設定になっているか
3. ログファイルを確認
   - `logs/auto_resume_startup.log` を確認

## 手動実行（テスト用）

自動再開機能を手動でテストする場合：

```powershell
# 自動再開スクリプトを直接実行
py -3 scripts/auto_resume.py

# またはスタートアップスクリプトを実行
cmd /c scripts\auto_resume_startup.bat
```

## 注意事項

- タスクスケジューラーの登録には管理者権限が必要です
- セッションファイルのパスは絶対パスで管理されます
- セッション有効期限は7日間です（設定可能）
- 完了済みセッションは自動再開されません

