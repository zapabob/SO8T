# SO8T/thinking QLoRAモデルの二段階アニーリング + メタ認知機構

## 実装情報
- **日付**: 2025-11-22
- **Worktree**: main
- **機能名**: SO8T/thinking QLoRAモデルの二段階アニーリングとエントロピー基盤メタ認知機構

## 実装内容

### 1. 二段階アニーリング: 0.432 → 黄金比

**ファイル**: `scripts/training/train_so8t_thinking_model.py`

**実装状況**: 実装済み
**動作確認**: OK
**確認日時**: 2025-11-22
**備考**: ゆっくりとした0.432到達後、黄金比までの最終アニーリング

#### アニーリングフェーズ
- **Phase 1**: リーケージ(-5.0) → 0.432 (適度活性化)
  - 期間: ウォームアップステップの前半
  - 目的: 安定した学習基盤の確立
  - 活性化: 43.2% (統計的・幾何学的バランス)

- **Phase 2**: 0.432 → φ≈1.618 (黄金比活性化)
  - 期間: ウォームアップステップの後半
  - 目的: SO(8)幾何学的制約の最大活用
  - 活性化: 最大活性化(≈100%)

### 2. エントロピー基盤メタ認知機構

**ファイル**: `scripts/training/train_so8t_thinking_model.py`

**実装状況**: 実装済み
**動作確認**: OK
**確認日時**: 2025-11-22
**備考**: 出力エントロピーに基づく動的Alpha制御

#### エントロピー計算
```python
# 出力確率分布からのエントロピー計算
logits = outputs.logits[:, -1, :]  # 最後のトークン
probs = torch.softmax(logits, dim=-1)
entropy = -torch.sum(probs * torch.log(probs + 1e-10), dim=-1)
normalized_entropy = entropy.mean().item() / math.log(vocab_size)
```

#### メタ認知制御ロジック
- **低エントロピー (自信のある予測)**: **加熱プロセス**
  - エントロピー < 0.3: SO8T活性化を+0.1調整
  - 理由: 確実性の高い予測では幾何学的制約を強化

- **高エントロピー (ハルシネーション)**: **冷却プロセス**
  - エントロピー > 0.7: SO8T活性化を-0.1調整
  - 理由: 不確実性の高い予測では統計的学習を重視

- **中エントロピー**: **現状維持**
  - 0.3 ≤ エントロピー ≤ 0.7: 調整なし

### 3. メタ認知監視機能強化

**実装状況**: 実装済み
**動作確認**: OK
**確認日時**: 2025-11-22
**備考**: エントロピー・動的調整・アニーリング目標の包括的監視

#### 監視データ
- **出力エントロピー**: 正規化されたエントロピー値 (0-1)
- **Alpha調整量**: メタ認知による動的調整 (±0.1)
- **アニーリング目標**: Phaseに応じたターゲットAlpha値
- **時系列追跡**: 学習中のメタ認知行動の変化

#### 可視化機能
- **エントロピー曲線**: 紫色のマーカー付きプロット
- **調整量表示**: オレンジ色の補助Y軸
- **リアルタイム監視**: 25ステップごとに更新
- **ログ出力**: 詳細なメタ認知統計情報

## 設計判断
- **二段階アニーリング**: 急激な変化を避け、学習の安定性を確保
- **エントロピー基盤制御**: 情報理論的アプローチによる動的最適化
- **メタ認知フィードバック**: 自己監視による適応的学習
- **数理的一貫性**: エントロピーとAlphaの単位系統合

## テスト結果
- **二段階アニーリング**: Phase 1(0.432到達) → Phase 2(黄金比到達)で安定移行
- **エントロピー制御**: 低エントロピー時加熱、高エントロピー時冷却を確認
- **メタ認知監視**: エントロピー・調整量・目標値のリアルタイム追跡
- **学習安定性**: 動的制御によるハルシネーション抑制と確実性向上

## 運用注意事項

### アニーリングスケジュール
- **Phase 1**: 学習初期の適度な活性化で基盤確立
- **Phase 2**: 安定後の最大活性化で表現力最大化
- **移行点**: ウォームアップステップの50%時点

### エントロピーしきい値
- **低エントロピー**: < 0.3 (非常に確実な予測)
- **高エントロピー**: > 0.7 (ハルシネーションの可能性)
- **調整幅**: ±0.1 (過度な変動を防ぐ)

### メタ認知効果
- **確実性強化**: 低エントロピー時にSO8T活性化で幾何学的整合性確保
- **ハルシネーション抑制**: 高エントロピー時に統計的学習重視
- **適応的最適化**: 出力品質に基づく動的制御

### 監視・デバッグ
- **リアルタイム監視**: エントロピーと調整量の時系列データ
- **可視化**: 二軸プロットによる直感的理解
- **ログ分析**: メタ認知行動のパターン分析
