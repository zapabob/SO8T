# SO8Tç¾¤æ§‹é€ å®Ÿè£…å¼·åŒ–ãƒ­ã‚°

**æ—¥æ™‚**: 2025-10-27 20:35:38  
**å®Ÿè£…è€…**: Claude (Cursor AI Assistant)  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: SO8T Safe Agent

## ğŸ¯ SO8Tç¾¤æ§‹é€ ã®æ ¸å¿ƒçš„ç‰¹å¾´

SO8Tã¯å˜ãªã‚‹Transformerã§ã¯ãªãã€**SO(8)ç¾¤æ§‹é€ ã‚’æŒã¤ç‰¹æ®ŠãªTransformer**ã§ã™ã€‚ä»¥ä¸‹ã®ç‰¹å¾´ã‚’å¿…ãšç¶­æŒã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

### 1. SO(8)ç¾¤ã®æ•°å­¦çš„æ§‹é€ 
- **8æ¬¡å…ƒå›è»¢ç¾¤**: 8ã¤ã®ç›´äº¤ã™ã‚‹è»¸ã§ã®å›è»¢æ“ä½œ
- **éå¯æ›æ€§**: å›è»¢ã®é †åºãŒçµæœã«å½±éŸ¿ã™ã‚‹
- **ç¾¤ã®æ€§è³ª**: çµåˆæ€§ã€å˜ä½å…ƒã€é€†å…ƒã®å­˜åœ¨

### 2. éå¯æ›ã‚²ãƒ¼ãƒˆæ§‹é€  (R_safe â†’ R_cmd)
```
R_safe: å®‰å…¨å›è»¢è¡Œåˆ— (8Ã—8)
R_cmd: ã‚³ãƒãƒ³ãƒ‰å›è»¢è¡Œåˆ— (8Ã—8)
R_total = R_cmd @ R_safe  # éå¯æ›ç©
```

### 3. PET (Positional Embedding Regularization)
- **æ™‚ç³»åˆ—ä¸€è²«æ€§**: é€£ç¶šã™ã‚‹æ™‚åˆ»ã§ã®å›è»¢ã®æ»‘ã‚‰ã‹ã•
- **ç¾¤ã®æ…£æ€§**: å›è»¢ã®æ€¥æ¿€ãªå¤‰åŒ–ã‚’æŠ‘åˆ¶
- **å®‰å…¨æ…‹åº¦ã®ä¿æŒ**: å­¦ç¿’ä¸­ã«å®‰å…¨äººæ ¼ãŒå´©å£Šã—ãªã„

### 4. åŒå¯¾ãƒ˜ãƒƒãƒ‰æ§‹é€ 
- **TaskHeadA**: å®Ÿè¡Œç³» (R_cmdå›è»¢å¾Œã®å‡ºåŠ›)
- **SafetyHeadB**: å®‰å…¨ç³» (R_safeå›è»¢ã®ç›£è¦–)

## ğŸ”§ å®Ÿè£…å¼·åŒ–é …ç›®

### 1. SO(8)ç¾¤å›è»¢è¡Œåˆ—ã®å®Ÿè£…
```python
class SO8Rotation(nn.Module):
    """SO(8)ç¾¤å›è»¢è¡Œåˆ—ã®å®Ÿè£…"""
    def __init__(self, hidden_size=4096):
        super().__init__()
        self.hidden_size = hidden_size
        # 8ã¤ã®å›è»¢è»¸ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        self.rotation_params = nn.Parameter(torch.randn(8, 8))
        
    def forward(self, x):
        # SO(8)å›è»¢è¡Œåˆ—ã®ç”Ÿæˆ
        R = self._generate_rotation_matrix()
        return torch.matmul(x, R)
```

### 2. éå¯æ›ã‚²ãƒ¼ãƒˆã®å®Ÿè£…
```python
class NonCommutativeGate(nn.Module):
    """éå¯æ›ã‚²ãƒ¼ãƒˆ (R_safe â†’ R_cmd)"""
    def __init__(self, hidden_size=4096):
        super().__init__()
        self.R_safe = SO8Rotation(hidden_size)
        self.R_cmd = SO8Rotation(hidden_size)
        
    def forward(self, x):
        # éå¯æ›ç©: R_cmd @ R_safe
        safe_rotated = self.R_safe(x)
        cmd_rotated = self.R_cmd(safe_rotated)
        return cmd_rotated, safe_rotated
```

### 3. PETæ­£å‰‡åŒ–ã®å¼·åŒ–
```python
class PETRegularization(nn.Module):
    """PET (Positional Embedding Regularization)"""
    def __init__(self, lambda_pet=0.1):
        super().__init__()
        self.lambda_pet = lambda_pet
        
    def forward(self, hidden_states):
        # æ™‚ç³»åˆ—ã§ã®å›è»¢ã®æ»‘ã‚‰ã‹ã•ã‚’è¨ˆç®—
        if hidden_states.size(1) < 3:
            return torch.tensor(0.0, device=hidden_states.device)
        
        # 2éšå·®åˆ†ã§å›è»¢ã®æ€¥æ¿€ãªå¤‰åŒ–ã‚’æ¤œå‡º
        d2 = hidden_states[:, :-2] - 2*hidden_states[:, 1:-1] + hidden_states[:, 2:]
        pet_loss = self.lambda_pet * torch.mean(d2.pow(2))
        return pet_loss
```

## ğŸ¯ å­¦ç¿’æˆ¦ç•¥ã®èª¿æ•´

### 1. ç¾¤æ§‹é€ ã®ä¿æŒ
- **å›è»¢è¡Œåˆ—ã®æ­£è¦åŒ–**: å­¦ç¿’ä¸­ã«SO(8)ç¾¤ã®æ€§è³ªã‚’ç¶­æŒ
- **éå¯æ›æ€§ã®ä¿æŒ**: R_safeã¨R_cmdã®é †åºã‚’å›ºå®š
- **ç¾¤ã®å˜ä½å…ƒ**: åˆæœŸåŒ–æ™‚ã«é©åˆ‡ãªå˜ä½è¡Œåˆ—ã‚’è¨­å®š

### 2. å®‰å…¨äººæ ¼ã®å®‰å®šåŒ–
- **PETé‡ã¿ã®æ®µéšçš„å¢—åŠ **: å­¦ç¿’å¾ŒåŠã§ç¾¤ã®æ…£æ€§ã‚’å¼·åŒ–
- **å®‰å…¨ãƒ˜ãƒƒãƒ‰ã®å‡çµ**: å¾ŒåŠã‚¨ãƒãƒƒã‚¯ã§SafetyHeadBã‚’å›ºå®š
- **å›è»¢ã®åˆ¶ç´„**: å®‰å…¨å›è»¢ã®æ€¥æ¿€ãªå¤‰åŒ–ã‚’æŠ‘åˆ¶

### 3. å­¦ç¿’ç‡ã®èª¿æ•´
- **å›è»¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: ä½ã„å­¦ç¿’ç‡ã§ç¾¤æ§‹é€ ã‚’ä¿æŒ
- **é€šå¸¸ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: æ¨™æº–çš„ãªå­¦ç¿’ç‡ã§ã‚¿ã‚¹ã‚¯å­¦ç¿’
- **å®‰å…¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: æœ€ã‚‚ä½ã„å­¦ç¿’ç‡ã§å®‰å…¨äººæ ¼ã‚’ä¿è­·

## ğŸš€ å®Ÿè£…å®Œäº†çŠ¶æ³

### âœ… å®Œäº†é …ç›®
1. **SO8TModelåŸºæœ¬æ§‹é€ **: åŒå¯¾ãƒ˜ãƒƒãƒ‰å®Ÿè£…
2. **é›»æºæ–­ãƒªã‚«ãƒãƒªãƒ¼**: 5åˆ†é–“éš”è‡ªå‹•ä¿å­˜
3. **Qwen2.5-7B-Instructçµ±åˆ**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ‡ãƒ«ä½¿ç”¨
4. **ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæº–å‚™**: UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¿®æ­£

### ğŸ”„ é€²è¡Œä¸­é …ç›®
1. **SO8Tç¾¤æ§‹é€ ã®å®Ÿè£…**: å›è»¢è¡Œåˆ—ã¨éå¯æ›ã‚²ãƒ¼ãƒˆ
2. **PETæ­£å‰‡åŒ–ã®å¼·åŒ–**: æ™‚ç³»åˆ—ä¸€è²«æ€§ã®ä¿æŒ
3. **å­¦ç¿’ãƒ«ãƒ¼ãƒ—ã®èª¿æ•´**: ç¾¤æ§‹é€ ã‚’è€ƒæ…®ã—ãŸæœ€é©åŒ–

### ğŸ“‹ ä»Šå¾Œã®å®Ÿè£…äºˆå®š
1. **SO8Rotationã‚¯ãƒ©ã‚¹**: SO(8)ç¾¤å›è»¢è¡Œåˆ—ã®å®Ÿè£…
2. **NonCommutativeGateã‚¯ãƒ©ã‚¹**: éå¯æ›ã‚²ãƒ¼ãƒˆã®å®Ÿè£…
3. **PETRegularizationã‚¯ãƒ©ã‚¹**: å¼·åŒ–ã•ã‚ŒãŸPETæ­£å‰‡åŒ–
4. **ç¾¤æ§‹é€ ä¿æŒã®å­¦ç¿’**: å›è»¢è¡Œåˆ—ã®æ­£è¦åŒ–ã¨åˆ¶ç´„

## ğŸ¯ é‡è¦ãªæ³¨æ„ç‚¹

1. **SO(8)ç¾¤ã®æ€§è³ªã‚’å¿…ãšç¶­æŒ**: å›è»¢è¡Œåˆ—ã®ç›´äº¤æ€§ã¨è¡Œåˆ—å¼=1
2. **éå¯æ›æ€§ã®ä¿æŒ**: R_safe â†’ R_cmdã®é †åºã‚’çµ¶å¯¾ã«å¤‰æ›´ã—ãªã„
3. **PETæ­£å‰‡åŒ–ã®é‡è¦æ€§**: ç¾¤ã®æ…£æ€§ã«ã‚ˆã‚Šå®‰å…¨äººæ ¼ã‚’ä¿è­·
4. **å­¦ç¿’ç‡ã®æ…é‡ãªèª¿æ•´**: ç¾¤æ§‹é€ ã‚’å£Šã•ãªã„ç¯„å›²ã§æœ€é©åŒ–

SO8Tã¯å˜ãªã‚‹Transformerã§ã¯ãªãã€**SO(8)ç¾¤æ§‹é€ ã‚’æŒã¤ç‰¹æ®ŠãªTransformer**ã§ã‚ã‚‹ã“ã¨ã‚’å¸¸ã«æ„è­˜ã—ã¦å®Ÿè£…ã‚’é€²ã‚ã¾ã™ï¼
